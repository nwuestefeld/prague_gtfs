%% Generated by Sphinx.
\def\sphinxdocclass{report}
\documentclass[letterpaper,10pt,english]{sphinxmanual}
\ifdefined\pdfpxdimen
   \let\sphinxpxdimen\pdfpxdimen\else\newdimen\sphinxpxdimen
\fi \sphinxpxdimen=.75bp\relax
\ifdefined\pdfimageresolution
    \pdfimageresolution= \numexpr \dimexpr1in\relax/\sphinxpxdimen\relax
\fi
%% let collapsible pdf bookmarks panel have high depth per default
\PassOptionsToPackage{bookmarksdepth=5}{hyperref}

\PassOptionsToPackage{booktabs}{sphinx}
\PassOptionsToPackage{colorrows}{sphinx}

\PassOptionsToPackage{warn}{textcomp}
\usepackage[utf8]{inputenc}
\ifdefined\DeclareUnicodeCharacter
% support both utf8 and utf8x syntaxes
  \ifdefined\DeclareUnicodeCharacterAsOptional
    \def\sphinxDUC#1{\DeclareUnicodeCharacter{"#1}}
  \else
    \let\sphinxDUC\DeclareUnicodeCharacter
  \fi
  \sphinxDUC{00A0}{\nobreakspace}
  \sphinxDUC{2500}{\sphinxunichar{2500}}
  \sphinxDUC{2502}{\sphinxunichar{2502}}
  \sphinxDUC{2514}{\sphinxunichar{2514}}
  \sphinxDUC{251C}{\sphinxunichar{251C}}
  \sphinxDUC{2572}{\textbackslash}
\fi
\usepackage{cmap}
\usepackage[T1]{fontenc}
\usepackage{amsmath,amssymb,amstext}
\usepackage{babel}



\usepackage{tgtermes}
\usepackage{tgheros}
\renewcommand{\ttdefault}{txtt}



\usepackage[Bjarne]{fncychap}
\usepackage{sphinx}

\fvset{fontsize=auto}
\usepackage{geometry}


% Include hyperref last.
\usepackage{hyperref}
% Fix anchor placement for figures with captions.
\usepackage{hypcap}% it must be loaded after hyperref.
% Set up styles of URL: it should be placed after hyperref.
\urlstyle{same}


\usepackage{sphinxmessages}
\setcounter{tocdepth}{1}



\title{Prague GTFS}
\date{Jun 11, 2025}
\release{0.1.0}
\author{Nils Wüstefeld, Adam Pasálek}
\newcommand{\sphinxlogo}{\vbox{}}
\renewcommand{\releasename}{Release}
\makeindex
\begin{document}

\ifdefined\shorthandoff
  \ifnum\catcode`\=\string=\active\shorthandoff{=}\fi
  \ifnum\catcode`\"=\active\shorthandoff{"}\fi
\fi

\pagestyle{empty}
\sphinxmaketitle
\pagestyle{plain}
\sphinxtableofcontents
\pagestyle{normal}
\phantomsection\label{\detokenize{index::doc}}


\sphinxAtStartPar
Welcome to the Prague GTFS documentation!

\sphinxstepscope


\chapter{API Reference}
\label{\detokenize{api:module-client}}\label{\detokenize{api:api-reference}}\label{\detokenize{api::doc}}\index{module@\spxentry{module}!client@\spxentry{client}}\index{client@\spxentry{client}!module@\spxentry{module}}
\sphinxAtStartPar
client.py: Defines the Client class to refresh local GTFS databases.

\sphinxAtStartPar
The Client class loads API credentials from Streamlit session state,
and orchestrates fetching static routes, stops, and trips data
into a local SQLite database.
\index{Client (class in client)@\spxentry{Client}\spxextra{class in client}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:client.Client}}
\pysigstartsignatures
\pysigline{\sphinxbfcode{\sphinxupquote{class\DUrole{w}{ }}}\sphinxcode{\sphinxupquote{client.}}\sphinxbfcode{\sphinxupquote{Client}}}
\pysigstopsignatures
\sphinxAtStartPar
Orchestrates GTFS data refresh by calling individual managers.
\begin{description}
\sphinxlineitem{Attributes:}
\sphinxAtStartPar
api\_key (str): API key loaded from Streamlit session state.
api\_url (str): Base URL for GTFS API.
headers (dict): HTTP headers for API requests.
db\_path (str): Local path to the SQLite database file.
routemanager (RouteManager): Manager for GTFS routes.
stopmanager (StopManager): Manager for GTFS stops.
tripmanager (TripManager): Manager for GTFS trips.

\end{description}
\index{run() (client.Client method)@\spxentry{run()}\spxextra{client.Client method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:client.Client.run}}
\pysigstartsignatures
\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{run}}}{}{}
\pysigstopsignatures
\sphinxAtStartPar
Run all data managers to refresh local GTFS tables.

\sphinxAtStartPar
Calls set\_routes, set\_stops, and set\_trips in order to
update the SQLite database with the latest static GTFS data.

\end{fulllineitems}


\end{fulllineitems}

\index{module@\spxentry{module}!managers.route\_manager@\spxentry{managers.route\_manager}}\index{managers.route\_manager@\spxentry{managers.route\_manager}!module@\spxentry{module}}\index{RouteManager (class in managers.route\_manager)@\spxentry{RouteManager}\spxextra{class in managers.route\_manager}}\phantomsection\label{\detokenize{api:module-managers.route_manager}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:managers.route_manager.RouteManager}}
\pysigstartsignatures
\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class\DUrole{w}{ }}}\sphinxcode{\sphinxupquote{managers.route\_manager.}}\sphinxbfcode{\sphinxupquote{RouteManager}}}{\sphinxparam{\DUrole{n}{api\_url}}\sphinxparamcomma \sphinxparam{\DUrole{n}{db\_path}}\sphinxparamcomma \sphinxparam{\DUrole{n}{headers}}}{}
\pysigstopsignatures
\sphinxAtStartPar
Manages GTFS route data: fetches from the API and loads into a local SQLite database.
\begin{description}
\sphinxlineitem{Attributes:}
\sphinxAtStartPar
api\_url (str): Base URL of the GTFS API.
db\_path (str): File path to the SQLite database.
headers (dict): HTTP headers containing the API authentication token.

\end{description}
\index{create\_route\_table() (managers.route\_manager.RouteManager method)@\spxentry{create\_route\_table()}\spxextra{managers.route\_manager.RouteManager method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:managers.route_manager.RouteManager.create_route_table}}
\pysigstartsignatures
\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{create\_route\_table}}}{}{}
\pysigstopsignatures
\sphinxAtStartPar
Create the ‘routes’ table in the SQLite database if it does not already exist.

\sphinxAtStartPar
The table includes fields for route ID, names, type flags, colors, and last modification timestamp.

\end{fulllineitems}

\index{get\_routes() (managers.route\_manager.RouteManager method)@\spxentry{get\_routes()}\spxextra{managers.route\_manager.RouteManager method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:managers.route_manager.RouteManager.get_routes}}
\pysigstartsignatures
\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{get\_routes}}}{}{}
\pysigstopsignatures
\sphinxAtStartPar
Fetch all routes from the GTFS API.
\begin{description}
\sphinxlineitem{Returns:}
\sphinxAtStartPar
list: A list of route dictionaries on success.

\sphinxlineitem{Raises:}
\sphinxAtStartPar
Exception: If the HTTP response status is not 200.

\end{description}

\end{fulllineitems}

\index{set\_routes() (managers.route\_manager.RouteManager method)@\spxentry{set\_routes()}\spxextra{managers.route\_manager.RouteManager method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:managers.route_manager.RouteManager.set_routes}}
\pysigstartsignatures
\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{set\_routes}}}{}{}
\pysigstopsignatures
\sphinxAtStartPar
Fetch route data and populate the local database.

\sphinxAtStartPar
Skips any routes with ‘route\_type’ == 2 (trains) and inserts or replaces
remaining routes into the ‘routes’ table.

\end{fulllineitems}


\end{fulllineitems}

\index{module@\spxentry{module}!managers.stop\_manager@\spxentry{managers.stop\_manager}}\index{managers.stop\_manager@\spxentry{managers.stop\_manager}!module@\spxentry{module}}\index{module@\spxentry{module}!managers.trip\_manager@\spxentry{managers.trip\_manager}}\index{managers.trip\_manager@\spxentry{managers.trip\_manager}!module@\spxentry{module}}\index{TripManager (class in managers.trip\_manager)@\spxentry{TripManager}\spxextra{class in managers.trip\_manager}}\phantomsection\label{\detokenize{api:module-managers.stop_manager}}\phantomsection\label{\detokenize{api:module-managers.trip_manager}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:managers.trip_manager.TripManager}}
\pysigstartsignatures
\pysigline{\sphinxbfcode{\sphinxupquote{class\DUrole{w}{ }}}\sphinxcode{\sphinxupquote{managers.trip\_manager.}}\sphinxbfcode{\sphinxupquote{TripManager}}}
\pysigstopsignatures
\sphinxAtStartPar
Manage GTFS trip data: initialize API settings and load trip information into a local SQLite database.
\begin{description}
\sphinxlineitem{Attributes:}
\sphinxAtStartPar
api\_key (str): The API key for GTFS requests.
api\_url (str): Base URL for the GTFS API.
headers (dict): HTTP headers including the API key.
db\_path (str): Path to the local SQLite database file.

\end{description}
\index{create\_trip\_table() (managers.trip\_manager.TripManager method)@\spxentry{create\_trip\_table()}\spxextra{managers.trip\_manager.TripManager method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:managers.trip_manager.TripManager.create_trip_table}}
\pysigstartsignatures
\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{create\_trip\_table}}}{}{}
\pysigstopsignatures
\sphinxAtStartPar
Create the ‘trips’ table in the local SQLite database if it does not exist.

\sphinxAtStartPar
The table stores information about trip IDs, route IDs, service IDs, headsigns,
directions, block IDs, shape IDs, accessibility flags, bike flags, exceptions, and last modification.

\end{fulllineitems}

\index{get\_infos\_by\_trip\_id() (managers.trip\_manager.TripManager method)@\spxentry{get\_infos\_by\_trip\_id()}\spxextra{managers.trip\_manager.TripManager method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:managers.trip_manager.TripManager.get_infos_by_trip_id}}
\pysigstartsignatures
\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{get\_infos\_by\_trip\_id}}}{\sphinxparam{\DUrole{n}{trip\_ids}}}{}
\pysigstopsignatures
\sphinxAtStartPar
Retrieve additional route information for a list of trip IDs.
\begin{description}
\sphinxlineitem{Args:}
\sphinxAtStartPar
trip\_ids (list{[}str{]}): List of trip IDs to look up.

\sphinxlineitem{Returns:}
\sphinxAtStartPar
pandas.DataFrame: DataFrame containing trip\_id, shape\_id,
route\_short\_name, route\_long\_name, and route\_color.

\end{description}

\end{fulllineitems}

\index{get\_trips() (managers.trip\_manager.TripManager method)@\spxentry{get\_trips()}\spxextra{managers.trip\_manager.TripManager method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:managers.trip_manager.TripManager.get_trips}}
\pysigstartsignatures
\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{get\_trips}}}{}{}
\pysigstopsignatures
\sphinxAtStartPar
Fetch all trip records from the GTFS API.
\begin{description}
\sphinxlineitem{Returns:}
\sphinxAtStartPar
list: A list of trip dictionaries from the API.

\sphinxlineitem{Raises:}
\sphinxAtStartPar
Exception: If the HTTP response status is not 200.

\end{description}

\end{fulllineitems}

\index{set\_trips() (managers.trip\_manager.TripManager method)@\spxentry{set\_trips()}\spxextra{managers.trip\_manager.TripManager method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:managers.trip_manager.TripManager.set_trips}}
\pysigstartsignatures
\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{set\_trips}}}{}{}
\pysigstopsignatures
\sphinxAtStartPar
Populate the local database with trip information from the GTFS API.

\sphinxAtStartPar
Creates the trips table if needed, fetches trip data, and inserts or replaces
each trip record in the SQLite database.

\end{fulllineitems}


\end{fulllineitems}

\index{module@\spxentry{module}!managers.request\_manager@\spxentry{managers.request\_manager}}\index{managers.request\_manager@\spxentry{managers.request\_manager}!module@\spxentry{module}}\index{RequestManager (class in managers.request\_manager)@\spxentry{RequestManager}\spxextra{class in managers.request\_manager}}\phantomsection\label{\detokenize{api:module-managers.request_manager}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:managers.request_manager.RequestManager}}
\pysigstartsignatures
\pysigline{\sphinxbfcode{\sphinxupquote{class\DUrole{w}{ }}}\sphinxcode{\sphinxupquote{managers.request\_manager.}}\sphinxbfcode{\sphinxupquote{RequestManager}}}
\pysigstopsignatures
\sphinxAtStartPar
Manages SSH connection and SQL queries to the remote vehicle\_positions database.

\sphinxAtStartPar
This class loads environment variables, opens an SSH tunnel to the remote SQLite database,
and provides methods to execute SQL queries and return results as pandas DataFrames.
\index{connect() (managers.request\_manager.RequestManager method)@\spxentry{connect()}\spxextra{managers.request\_manager.RequestManager method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:managers.request_manager.RequestManager.connect}}
\pysigstartsignatures
\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{connect}}}{}{}
\pysigstopsignatures
\sphinxAtStartPar
Establish an SSH connection to the remote database.

\sphinxAtStartPar
Reads SSH\_USER, SERVER\_ADRESS, and PEM key path from environment/session state,
then connects using Paramiko SSHClient.
\begin{description}
\sphinxlineitem{Raises:}
\sphinxAtStartPar
paramiko.SSHException: If SSH authentication or connection fails.

\end{description}

\end{fulllineitems}

\index{load\_env() (managers.request\_manager.RequestManager method)@\spxentry{load\_env()}\spxextra{managers.request\_manager.RequestManager method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:managers.request_manager.RequestManager.load_env}}
\pysigstartsignatures
\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{load\_env}}}{}{}
\pysigstopsignatures
\sphinxAtStartPar
Load environment variables from a .env file.

\end{fulllineitems}

\index{server\_request() (managers.request\_manager.RequestManager method)@\spxentry{server\_request()}\spxextra{managers.request\_manager.RequestManager method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:managers.request_manager.RequestManager.server_request}}
\pysigstartsignatures
\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{server\_request}}}{\sphinxparam{\DUrole{n}{sql\_query}}\sphinxparamcomma \sphinxparam{\DUrole{n}{columns}\DUrole{o}{=}\DUrole{default_value}{None}}}{}
\pysigstopsignatures
\sphinxAtStartPar
Execute a SQL query on the remote SQLite database via SSH.
\begin{description}
\sphinxlineitem{Args:}
\sphinxAtStartPar
sql\_query (str): The SQL query to run on the remote database.
columns (list{[}str{]}, optional): Column names for the returned DataFrame.

\sphinxlineitem{Returns:}
\sphinxAtStartPar
pandas.DataFrame or None: A DataFrame with query results (empty if no data),
or None if an error occurred.

\end{description}

\end{fulllineitems}


\end{fulllineitems}

\index{module@\spxentry{module}!shape@\spxentry{shape}}\index{shape@\spxentry{shape}!module@\spxentry{module}}\phantomsection\label{\detokenize{api:module-shape}}
\sphinxAtStartPar
shape.py: Extract tariff zone polygons from a PID shapefile and save as WKT.

\sphinxAtStartPar
Reads ‘DOP\_PID\_TARIFPASMA\_P.shp’ from a zip archive, filters for zone ‘P’,
creates a unified polygon, and writes the result to ‘tariff\_zones.wkt’.
\index{main() (in module shape)@\spxentry{main()}\spxextra{in module shape}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{api:shape.main}}
\pysigstartsignatures
\pysiglinewithargsret{\sphinxcode{\sphinxupquote{shape.}}\sphinxbfcode{\sphinxupquote{main}}}{}{}
\pysigstopsignatures
\sphinxAtStartPar
Extract tariff zone polygons from a PID shapefile and save as WKT.

\end{fulllineitems}



\renewcommand{\indexname}{Python Module Index}
\begin{sphinxtheindex}
\let\bigletter\sphinxstyleindexlettergroup
\bigletter{c}
\item\relax\sphinxstyleindexentry{client}\sphinxstyleindexpageref{api:\detokenize{module-client}}
\indexspace
\bigletter{m}
\item\relax\sphinxstyleindexentry{managers.request\_manager}\sphinxstyleindexpageref{api:\detokenize{module-managers.request_manager}}
\item\relax\sphinxstyleindexentry{managers.route\_manager}\sphinxstyleindexpageref{api:\detokenize{module-managers.route_manager}}
\item\relax\sphinxstyleindexentry{managers.stop\_manager}\sphinxstyleindexpageref{api:\detokenize{module-managers.stop_manager}}
\item\relax\sphinxstyleindexentry{managers.trip\_manager}\sphinxstyleindexpageref{api:\detokenize{module-managers.trip_manager}}
\indexspace
\bigletter{s}
\item\relax\sphinxstyleindexentry{shape}\sphinxstyleindexpageref{api:\detokenize{module-shape}}
\end{sphinxtheindex}

\renewcommand{\indexname}{Index}
\printindex
\end{document}